<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar contraseña - Radio Anime</title>
    <link rel="icon" href="{{ url_for('static', filename='Kako10thAnniversaryChibi.ico') }}" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pink: { 200: '#fecaca', 400: '#f472b6', 500: '#ec4899', 600: '#db2777' },
                        purple: { 200: '#e9d5ff' },
                        indigo: { 200: '#c7d2fe' }
                    }
                }
            }
        }
    </script>
    <script>
        function resetPassword(event) {
            event.preventDefault();
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirm_password').value;
            const token = new URLSearchParams(window.location.search).get('token');

            if (!password || !confirm) {
                showToast("Por favor completa ambos campos", "error");
                return;
            }

            if (password !== confirm) {
                showToast("Las contraseñas no coinciden", "error");
                return;
            }

            fetch('/reset-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, "error");
                } else {
                    showToast("Contraseña cambiada con éxito", "success");
                    setTimeout(() => window.location.href = "/", 2000);
                }
            })
            .catch(err => {
                console.error(err);
                showToast("Ocurrió un error", "error");
            });
        }

        function showToast(message, type) {
            const toaster = document.getElementById('toaster');
            const toast = document.createElement('div');
            toast.className = `p-4 rounded-lg shadow-lg text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            toast.textContent = message;
            toaster.appendChild(toast);
            toaster.classList.remove('hidden');
            setTimeout(() => { toast.remove(); if (!toaster.children.length) toaster.classList.add('hidden'); }, 3000);
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 flex items-center justify-center p-6 font-sans transition-colors duration-300">

    <!-- Toaster -->
    <div id="toaster" class="fixed top-4 right-4 z-50 space-y-2 hidden"></div>

    <div class="bg-white/70 backdrop-blur-md rounded-3xl shadow-xl p-8 w-full max-w-md text-center">
        <!-- Imagen opcional centrada -->
{% if imagen_url %}
<img src="{{ imagen_url }}" alt="Imagen de recuperación"
     class="mx-auto w-full max-w-xs md:max-w-md h-auto object-contain mb-6 shadow-md rounded-2xl">
{% endif %}

        <h1 class="text-3xl font-extrabold text-pink-600 mb-4">Recuperar contraseña</h1>
        <p class="text-gray-700 mb-6">Ingresa tu nueva contraseña y confirma para actualizarla.</p>

        <form onsubmit="resetPassword(event)" class="space-y-4">
            <input type="password" id="password" placeholder="Nueva contraseña" required
                class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white placeholder-gray-500 text-gray-900">
            
            <input type="password" id="confirm_password" placeholder="Confirmar contraseña" required
                class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white placeholder-gray-500 text-gray-900">
            
            <button type="submit"
                class="bg-pink-500 hover:bg-pink-600 text-white w-full py-3 rounded-lg font-semibold shadow-md transition-all duration-300">
                Cambiar contraseña
            </button>
        </form>
    </div>
</body>
</html>
